import pytest
from BDFit import StarFit, find_bands, provide_phot
from astropy.table import Table
import numpy as np
import astropy.units as u

bands = ['f435w','f606w','f814w','f070w','f090w','f115w','f140m','f150w','f162m','f182m',
        'f200w','f210m','f250m','f277w','f300m','f335m','f356w','f360m','f410m','f430m',
        'f444w','f460m','f480m']

UNCOVER_BD1 = np.array([
       [   3.64925359,    2.32325165],
       [   8.21184739,    1.70841574],
       [ 175.53014643,   17.55301464],
       [  33.09302424,    3.30930242],
       [ 389.84394991,   38.98439499],
       [1087.09766107,  108.70976611],
       [ 945.48474825,   94.54847482],
       [1081.95422191,  108.19542219],
       [1376.2892842 ,  137.62892842],
       [1032.17082469,  103.21708247],
       [1069.83554232,  106.98355423],
       [1083.8843401 ,  108.38843401],
       [ 762.69826177,   76.26982618],
       [ 707.65076703,   70.7650767 ],
       [ 660.98096023,   66.09809602],
       [ 795.27516309,   79.52751631],
       [ 802.44776267,   80.24477627],
       [ 824.62133039,   82.46213304],
       [ 764.53856901,   76.4538569 ],
       [ 654.51901917,   65.45190192],
       [ 621.07980993,   62.10798099],
       [ 503.76530484,   50.37653048],
       [ 475.889285  ,   47.5889285 ]]) * u.nJy

UNCOVER_BD2 = np.array([
       [np.nan,np.nan],
       [-3.6622268 , 13.3170512 ],
       [-1.00286912, 13.3319236 ],
       [ 2.7607433 ,  2.15627378],
       [ 6.89088699,  1.56358623],
       [44.05559325,  4.40555933],
       [ 4.91673298,  4.89947122],
       [21.19676191,  2.11967619],
       [38.34700526,  4.15235049],
       [ 6.38673826,  2.43758101],
       [11.45861373,  1.7981935 ],
       [22.54092943,  3.42756934],
       [ 9.98323366,  4.05034633],
       [ 9.11365893,  1.38286323],
       [11.31819301,  2.33376873],
       [ 5.94121186,  2.3370337 ],
       [22.37503068,  2.23750307],
       [17.39022677,  2.30046099],
       [76.68241059,  7.66824106],
       [69.11796954,  6.91179695],
       [59.97988635,  5.99798864],
       [39.31545415,  6.15581123],
       [47.03939323,  5.53057882]]) * u.nJy

UNCOVER_BD3 = np.array([
       [   3.64925359,    2.32325165],
       [   8.21184739,    1.70841574],
       [ 175.53014643,   17.55301464],
       [  33.09302424,    3.30930242],
       [ 389.84394991,   38.98439499],
       [1087.09766107,  108.70976611],
       [ 945.48474825,   94.54847482],
       [1081.95422191,  108.19542219],
       [1376.2892842 ,  137.62892842],
       [1032.17082469,  103.21708247],
       [1069.83554232,  106.98355423],
       [1083.8843401 ,  108.38843401],
       [ 762.69826177,   76.26982618],
       [ 707.65076703,   70.7650767 ],
       [ 660.98096023,   66.09809602],
       [ 795.27516309,   79.52751631],
       [ 802.44776267,   80.24477627],
       [ 824.62133039,   82.46213304],
       [ 764.53856901,   76.4538569 ],
       [ 654.51901917,   65.45190192],
       [ 621.07980993,   62.10798099],
       [ 503.76530484,   50.37653048],
       [ 475.889285  ,   47.5889285 ]]) * u.nJy

def test_running():
    s = StarFit()

    flux = UNCOVER_BD1[:,0]
    error = UNCOVER_BD1[:,1]

    s.fit_catalog(fnu=flux, efnu=error, bands=[band.upper() for band in bands])

    s.plot_fit(idx=0, flux_unit=u.nJy)



